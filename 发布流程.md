#开发生产准备

##创建简单WEB页面
https://juejin.cn/post/6997962146902442020#heading-3
https://blog.csdn.net/wpw2000/article/details/113450048
https://blog.csdn.net/TGFXK/article/details/124468807

##环境隔离
开发环境、测试环境、预发环境、线上（生产）环境
maven
SwitchHosts管理不同环境的host

可以通过设置不同的配置文件、使用虚拟机、利用容器化技术(如Docker)来实现环境隔离。此外，还可以创建独立的数据库和存储环境，以确保开发人员不会误操作生产数据。

##部署流程
[个人Web项目上线教程](https://blog.csdn.net/u012183426/article/details/82718781?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-82718781-blog-90137375.235%5Ev27%5Epc_relevant_3mothn_strategy_and_data_recovery&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-82718781-blog-90137375.235%5Ev27%5Epc_relevant_3mothn_strategy_and_data_recovery&utm_relevant_index=1)

将java web上线，部署到公网，让所有人都可以访问

1.在myeclipse中开发好项目，打包成war格式

2.购买云服务器

3.登录云服务器，以下是教程

[linux系统的阿里云服务器](http://jingyan.baidu.com/article/84b4f565f3d99260f7da3271.html)

4.远程连接
以windows为例http://jingyan.baidu.com/article/cd4c297914be1e756e6e60c3.html

5.配置java web环境
可以不下载，直接将你电脑的jdk，tomcat，mysql复制粘贴到服务器
mysql数据库的数据可以自己再敲一遍，也可以从本地的mysql导出来，复制到服务器里面，再导进服务器的mysql。

6.发布项目

[web项目打成war包的三种方式](https://blog.csdn.net/cm15835106905/article/details/107927847?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-4-107927847-blog-122585695.235^v28^pc_relevant_default&spm=1001.2101.3001.4242.3&utm_relevant_index=7)
把jar包和资源通过xshell和xftp传到云服务器的linux系统中；
然后启动jar包开启服务器就可以访问了。

在本地电脑的浏览器打开，输入http://ip:8080/，其中http://是固定写法，ip为你买的阿里云服务器的外网ip，8080是你tomcat的端口号。回车，会看到tomcat的界面，其中有个tomcat Manager点以下，界面会提示输入你服务器的tomcat的用户和密码（在安装时会提示创建用户，没创建的卸载重装再创建，一定要有一个用户），输入后进入tomcat的另一个界面，点击一个“浏览”的按钮(该界面只有一个中文按钮)，选中第一步的war文件，然后点击按钮下的“Deploy”按钮,几秒后，界面会刷新。

刷新后，可以在任何有网络的电脑输入：http://ip:8080/application/.....（该url跟你在开发项目是的url是一样的，只是把localhost换成服务器的ip），就可以访问你的项目了。

7.用域名来代替http://ip:8080/......

7.1买域名,阿里云教程：http://jingyan.baidu.com/article/ab69b270dc91492ca7189f03.html

7.2域名备案教程：http://jingyan.baidu.com/article/925f8cb8176a49c0dde056c6.html

7.3域名解析教程：http://jingyan.baidu.com/article/676629973f96f454d51b849b.html

8.至此，可以在有网络下访问你的网站（项目）

###域名
一个域名只能对应一个IP地址，而一个IP却可以对应多个域名。如果使用的是独立IP虚拟主机、vps或者云主机，并且只绑定了一个网站，那么使用IP地址和域名都能访问网站，如果使用的共享IP虚拟主机或者绑定了多个网站，则只能使用域名访问网站。

##上线流程
###生产环境

###测试
一般不用maven项目自带的test，而是用postman进行接口测试
###预发布
https://juejin.cn/post/7137963558528090119
开发人员不能直接接触，这是运维人员保障上线质量的最后检查，运维标准也基本等同于生产环境。开发环境中研发人员有时会根据自己需要调整系统参数，如果release的时候仅仅交付了代码并没有指明系统参数修改，这时很容易出问题。
Maven环境隔离
https://juejin.cn/post/6844903875678470158
https://blog.csdn.net/QH_JAVA/article/details/53259412
新建maven项目
https://blog.csdn.net/erlian1992/article/details/53942096


web项目的预发布环境，一般是单独部署一个代码节点，连接的是生产环境的资源，比如DB，Cache，队列等。通过地址参数，cookie，请求头参数，vpn等方式，让测试人员可以接入这个特定的环境，做正式发布前的整体回归测试。然后还可以在负载均衡层面，接入小部分真实用户流量，观察性能变动和用户反馈，可以确定是否存在隐藏的性能问题和没有测试出来的bug。

预发布环境和生产环境：
1）预发环境中新功能为最新代码，其他功能代码和生产环境一致。
2）把预发布环境的访问域名设置成和线上环境的不一样，通过配置host来访问预发布环境。
3）中间件版本需要保持严格的一致（代码版本、数据库版本、中间件版本、依赖库/系统等版本、容器版本）
4）线上数据和预发需要的数据不能互相影响。预发布环境一般会连接生产环境的数据库，测试时要注意，以免产生脏数据，影响生产环境的使用。
5）预发布环境可以安装在生产环境同一个物理机上。

###上线
静态网页文件托管（默认CDN）
https://www.bilibili.com/video/BV18a4y1Y7e9?p=7&vd_source=97cfd40444b798b8f268faf7fc3dd004
1. 域名 DNS解析 
2. 服务器存放网站代码文件、数据库，实体的5000起步
性能：十几到几百人，最低配置基本能满足
地域：可以买附近的 CDN负载均衡服务器可以加速访问
带宽：影响速度可以用CDN，把大文件放到别的云存储上
IP：最好有独立公网IP，可以买云服务上的
云服务器 虚拟主机
centos操作系统
1. 备案（服务器供应商提供）

#实战演练
搭建一个基础工程，实现网站可访问，数据存储和发送网络请求等，学习怎么设计接口，信息加密，网络安全
##小项目
引入依赖、基本配置、完成接口、继续添加
###springboot-vue-demo（已跑通）
[视频教学](https://www.bilibili.com/video/BV14y4y1M7Nc/?spm_id_from=333.337.search-card.all.click&vd_source=97cfd40444b798b8f268faf7fc3dd004)
1. vue打包，config.js文件图片存储从local修改为服务器的公网ip
2. maven打包
3. xtfp上传
4. 云服务器新建数据库，拷贝本机数据
5.  启动nginx
6.  通过公网ip及设置的路由访问相应页面

[先连接数据库再运行springboot](https://blog.csdn.net/qq2523208472/article/details/89366264)

###springboot+vue
[视频链接](https://www.bilibili.com/video/BV1PQ4y1P7hZ/?p=1&vd_source=97cfd40444b798b8f268faf7fc3dd004)
[笔记](https://blog.csdn.net/weixin_43247803/article/details/113666136)

###登录验证
[实现用户登录拦截并验证](https://mp.weixin.qq.com/s?__biz=MzIxMjU5NjEwMA%3D%3D&chksm=97413d21a036b43759a4c7525529d836c7bd121ccb7156ddcc2a30d230f97c04a529ab3b9e15&idx=1&mid=2247506378&scene=21&sn=f2f647af608b61687659df4674acdcb6#wechat_redirect)

##环境配置
JDK20 1.8
TOMCAT10
NODE16

[JavaWeb项目打包上线简单流程](https://blog.csdn.net/yumenghao212/article/details/122585695?spm=1001.2101.3001.6650.8&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-8-122585695-blog-49205901.235%5Ev28%5Epc_relevant_default&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-8-122585695-blog-49205901.235%5Ev28%5Epc_relevant_default&utm_relevant_index=9)
[web项目打成war包的三种方式](https://blog.csdn.net/cm15835106905/article/details/107927847?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-4-107927847-blog-122585695.235^v28^pc_relevant_default&spm=1001.2101.3001.4242.3&utm_relevant_index=7)
[JDK+Tomcat+MySQL Linux部署上线](https://blog.csdn.net/syc000666/article/details/128281617?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-0-128281617-blog-128010946.235^v28^pc_relevant_default&spm=1001.2101.3001.4242.1&utm_relevant_index=3)
[python项目nginx](https://blog.csdn.net/MeiJin_/article/details/128010946?spm=1001.2101.3001.6650.2&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-2-128010946-blog-82718781.235%5Ev28%5Epc_relevant_default&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-2-128010946-blog-82718781.235%5Ev28%5Epc_relevant_default&utm_relevant_index=3)

##搭建云JAVA环境
**软件配置**
JDK1.8
node16
mysql8
**云服务器**
centos7.9
**账号**
云服务器 root 33337z3337S
ftp ftp 123456
VNC 3337zS
公网IP 59.110.229.72
ftp:\\59.110.229.72\
###步骤
[前后端分离 -- SpringBoot + Vue实战项目 部署至阿里云服务器](https://developer.aliyun.com/article/933729#slide-2)
1. [安装宝塔面板](https://www.yunfuwuqiba.com/aliyun/2050.html)，也可不安装
    ```
    yum install -y wget && wget -O install.sh http://download.bt.cn/install/install_6.0.sh && sh install.sh
    ```
    外网面板地址: https://59.110.229.72:15930/406ce493
    内网面板地址: https://172.30.243.122:15930/406ce493
    username: ma4b2yqm
    password: 4e61b890

2. windows终端登录服务器
ssh root@59.110.229.72
若服务器重置先执行ssh-keygen -R 59.110.229.72
3. 安装JDK
   - 执行以下命令，查看yum源中JDK版本。
   yum list java*
   - 执行以下命令，使用yum安装JDK1.8。
   yum -y install java-1.8.0-openjdk*
   - 执行以下命令，查看是否安装成功。
   java -version

4. 安装MySQL数据库
    ```
    wget http://dev.mysql.com/get/mysql57-community-release-el7-10.noarch.rpm
    yum -y install mysql57-community-release-el7-10.noarch.rpm
    yum -y install mysql-community-server --nogpgcheck
    ```
5. 安装Tomcat
    ```
    wget https://archive.apache.org/dist/tomcat/tomcat-8/v8.0.30/bin/apache-tomcat-8.0.30.tar.gz
    tar -zxvf apache-tomcat-8.0.30.tar.gz
    mv apache-tomcat-8.0.30 /usr/local/Tomcat8.0
    chmod +x /usr/local/Tomcat8.0/bin/*.sh
    sed -i 's/Connector port="8080"/Connector port="80"/' /usr/local/Tomcat8.0/conf/server.xml
    ```
    - 启动Tomcat
    /usr/local/Tomcat8.0/bin/./startup.sh
    - 关闭Tomcat
    /usr/local/Tomcat8.0/bin/./shutdown.sh

6. 安装Nginx服务
   - 安装Nginx运行所需要的插件。
       a.  安装gcc
   yum -y install gcc
       b.  安装pcre。
   yum install -y pcre pcre-devel
       c.  安装zlib。
   yum install -y zlib zlib-devel

   - 下载Nginx安装包。
   wget http://nginx.org/download/nginx-1.17.10.tar.gz
   - 解压Nginx安装包。
   tar -zxvf nginx-1.17.10.tar.gz
   - 编译安装Nginx。
   cd nginx-1.17.10
   ./configure
   make && make install
   - 启动Nginx。
   cd /usr/local/nginx/
   sbin/nginx
   - 关闭Nginx。
    ./nginx -s stop 或者ps -ef | grep nginx , kill -9 XXX

###打包上传
1. 前端
   >cd /home/user/server
    修改公网IP
    vim dist/static/config.js
    上传dist到pc里
2. 后端
    >将prod的localhost修改为公网IP
    clean compile package
    上传target里的jar包到api目录
    cd /root/work/class_manager/api
    执行：nohup java -jar springboot-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod &
    查看:tailf nohup.out
    ctrl c重新进入控制台
3. 配置nginx跨域
   >cd /usr/local/nginx/
    vim conf/nginx.conf
    ```vim
            location / {
                root   /work/class_manager/pc/dist;
                index  index.html index.htm;
                #开启后不会导致刷新白屏
                try_files $uri $uri/ /index.html;
            }

            location /api {
                    proxy_pass http://59.110.229.72:22/;
            }

            location /springbootajax/ {
                    proxy_pass http://59.110.229.72:22/springbootajax;
            }
    ```
    >启动nginx
    ./sbin/nginx -s reload或者cd /usr/local/nginx/，sbin/nginx
    报错nginx启动失败nginx: [error] open() "/usr/local/nginx/logs/nginx.pid" failed (2: No such file or directory)
    报错nginx: [emerg] still could not bind()
    解决办法：
    根据Nginx配置文件查看配置的端口（本文中使用的是80端口），然后根据端口查看端口占用情况
    netstat -ntlp|grep 80
    使用kill -9 XXX命令杀死占用进程，之后重新启动Nginx

    前端页面始终无法打开，nginx 500 internal server error。
    有两种可能：nginx未启动或跨域配置不对；端口实际上没有开放

1. 数据库
   service mysqld start
   mysql -u root -p
    [navicat连接](https://blog.csdn.net/nw_ningwang/article/details/76218997)
    新建springboot-vye数据库并导入数据

    navicat连接阿里云失败，因为云服务器数据库没有启动
    报错Access denied for user 'root'
    解决方案：
    vim /etc/my.cnf文件；
    在[mysqld]后添加skip-grant-tables（登录时跳过权限检查）


    
